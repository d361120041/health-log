# ğŸ‰ å¾Œç«¯é–‹ç™¼å®Œæˆå ±å‘Š

**å®Œæˆæ—¥æœŸï¼š** 2024-12-27  
**å°ˆæ¡ˆåç¨±ï¼š** æ¯æ—¥èº«é«”ç‹€æ³è¨˜éŒ„æ‡‰ç”¨ç¨‹å¼ - å¾Œç«¯éƒ¨åˆ†  
**æŠ€è¡“æ£§ï¼š** Java 21 + Spring Boot 3.5.8 + PostgreSQL + Redis + JWT

---

## ğŸ“‹ é–‹ç™¼æ¦‚è¦½

å¾Œç«¯é–‹ç™¼å·²å…¨éƒ¨å®Œæˆï¼Œæ¡ç”¨ **Maven å¤šæ¨¡çµ„æ¶æ§‹**ï¼Œå¯¦ç¾äº†å®Œæ•´çš„ RESTful APIã€å®‰å…¨èªè­‰æ©Ÿåˆ¶ã€EAV æ¨¡å¼æ•¸æ“šè™•ç†ç­‰åŠŸèƒ½ã€‚

### é–‹ç™¼æˆæœ
- âœ… **4 å€‹ Maven æ¨¡çµ„**ï¼šæ¸…æ™°çš„è·è²¬åˆ†é›¢
- âœ… **31 å€‹æ¸¬è©¦å…¨éƒ¨é€šé**ï¼šå®Œæ•´çš„æ¸¬è©¦è¦†è“‹
- âœ… **4 å€‹ Controller**ï¼šå®Œæ•´çš„ API ç«¯é»
- âœ… **5 å€‹ Service**ï¼šæ ¸å¿ƒæ¥­å‹™é‚è¼¯å¯¦ç¾
- âœ… **5 å€‹ Repository**ï¼šæ•¸æ“šå­˜å–å±¤
- âœ… **JWT å®‰å…¨æ©Ÿåˆ¶**ï¼šAccess Token + Refresh Token
- âœ… **EAV æ¨¡å¼è½‰æ›**ï¼šéˆæ´»çš„å‹•æ…‹æ¬„ä½ç³»çµ±

---

## ğŸ“ å°ˆæ¡ˆçµæ§‹

### Maven å¤šæ¨¡çµ„æ¶æ§‹

```
health-log-java/
â”œâ”€â”€ app-model/          # è³‡æ–™çµæ§‹å®šç¾©å±¤
â”‚   â”œâ”€â”€ Entity é¡åˆ¥     # User, Role, FieldSetting, DailyRecord, RecordData
â”‚   â””â”€â”€ DTO é¡åˆ¥        # LoginRequestDTO, AuthResponseDTO, RecordRequestDTO, etc.
â”‚
â”œâ”€â”€ app-data/           # è³‡æ–™åº«å­˜å–å±¤
â”‚   â””â”€â”€ Repository      # UserRepository, FieldSettingRepository, DailyRecordRepository, etc.
â”‚
â”œâ”€â”€ app-service/        # æ¥­å‹™é‚è¼¯å±¤
â”‚   â”œâ”€â”€ AuthService
â”‚   â”œâ”€â”€ RefreshTokenService
â”‚   â”œâ”€â”€ FieldSettingService
â”‚   â”œâ”€â”€ DailyRecordService
â”‚   â”œâ”€â”€ ReportService
â”‚   â””â”€â”€ JwtTokenUtil
â”‚
â””â”€â”€ app-web/            # Web å±¤ï¼ˆController + é…ç½®ï¼‰
    â”œâ”€â”€ Controller      # AuthController, FieldSettingController, DailyRecordController, ReportController
    â”œâ”€â”€ Config          # SecurityConfig, PasswordEncoderConfig
    â”œâ”€â”€ Filter          # JwtRequestFilter
    â””â”€â”€ Util            # SecurityUtil
```

### æ¨¡çµ„è·è²¬èªªæ˜

| æ¨¡çµ„ | è·è²¬ | ä¾è³´ |
|------|------|------|
| `app-model` | å¯¦é«”é¡åˆ¥å’Œ DTO å®šç¾© | ç„¡ |
| `app-data` | Repository ä»‹é¢ï¼ˆSpring Data JPAï¼‰ | `app-model` |
| `app-service` | æ¥­å‹™é‚è¼¯è™•ç† | `app-model`, `app-data` |
| `app-web` | Controllerã€é…ç½®ã€æ‡‰ç”¨å•Ÿå‹• | `app-service` |

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### 1. è³‡æ–™åº«å±¤ï¼ˆapp-model + app-dataï¼‰

#### Entity é¡åˆ¥
- âœ… **User** - ä½¿ç”¨è€…å¯¦é«”
  - æ¬„ä½ï¼šid, email, passwordHash, role, createdAt, isActive
  - é—œè¯ï¼šManyToOne Role, OneToMany DailyRecord

- âœ… **Role** - è§’è‰²å¯¦é«”
  - æ¬„ä½ï¼šid, roleName (USER, ADMIN)
  - é—œè¯ï¼šOneToMany User

- âœ… **FieldSetting** - æ¬„ä½è¨­å®šå¯¦é«”ï¼ˆEAV Attributeï¼‰
  - æ¬„ä½ï¼šsettingId, fieldName, dataType (NUMBER/TEXT/ENUM), unit, isRequired, options, isActive
  - é—œè¯ï¼šOneToMany RecordData

- âœ… **DailyRecord** - æ¯æ—¥è¨˜éŒ„å¯¦é«”
  - æ¬„ä½ï¼šrecordId, userId, recordDate, createdAt
  - é—œè¯ï¼šManyToOne User, OneToMany RecordData

- âœ… **RecordData** - è¨˜éŒ„æ•¸æ“šå¯¦é«”ï¼ˆEAV Valueï¼‰
  - æ¬„ä½ï¼šdataId, recordId, settingId, value
  - é—œè¯ï¼šManyToOne DailyRecord, ManyToOne FieldSetting

#### Repository ä»‹é¢
- âœ… `UserRepository` - ä½¿ç”¨è€…è³‡æ–™å­˜å–
- âœ… `RoleRepository` - è§’è‰²è³‡æ–™å­˜å–
- âœ… `FieldSettingRepository` - æ¬„ä½è¨­å®šè³‡æ–™å­˜å–
- âœ… `DailyRecordRepository` - æ¯æ—¥è¨˜éŒ„è³‡æ–™å­˜å–
- âœ… `RecordDataRepository` - è¨˜éŒ„æ•¸æ“šè³‡æ–™å­˜å–

**æ¸¬è©¦çµæœï¼š** æ‰€æœ‰ Repository æ¸¬è©¦é€šéï¼ˆä½¿ç”¨ `@DataJpaTest` + H2 å…§å­˜è³‡æ–™åº«ï¼‰

### 2. æ¥­å‹™é‚è¼¯å±¤ï¼ˆapp-serviceï¼‰

#### Service é¡åˆ¥

**AuthService**
- âœ… `login(LoginRequestDTO)` - ä½¿ç”¨è€…ç™»å…¥
  - é©—è­‰é›»å­éƒµä»¶å’Œå¯†ç¢¼
  - ç”Ÿæˆ Access Token å’Œ Refresh Token
  - è¿”å›èªè­‰éŸ¿æ‡‰
- âœ… `refreshToken(String)` - åˆ·æ–° Access Token
  - é©—è­‰ Refresh Token
  - ç”Ÿæˆæ–°çš„ Access Token å’Œ Refresh Token
- âœ… `logout(String)` - ä½¿ç”¨è€…ç™»å‡º
  - åˆªé™¤ Refresh Token
- âœ… `loadUserByUsername(String)` - Spring Security æ•´åˆ

**RefreshTokenService**
- âœ… `saveRefreshToken(Long userId)` - å„²å­˜ Refresh Token åˆ° Redis
- âœ… `getUserIdByTokenId(String tokenId)` - å¾ Redis ç²å–ä½¿ç”¨è€… ID
- âœ… `deleteRefreshToken(String tokenId)` - åˆªé™¤ Refresh Token

**FieldSettingService**
- âœ… `getAllActiveFieldSettings()` - ç²å–æ‰€æœ‰å•Ÿç”¨çš„æ¬„ä½è¨­å®š
- âœ… `getAllFieldSettings()` - ç²å–æ‰€æœ‰æ¬„ä½è¨­å®šï¼ˆåŒ…å«æœªå•Ÿç”¨ï¼‰
- âœ… `getFieldSettingById(Integer id)` - æ ¹æ“š ID ç²å–æ¬„ä½è¨­å®š
- âœ… `createFieldSetting(FieldSetting)` - å‰µå»ºæ¬„ä½è¨­å®š
- âœ… `updateFieldSetting(Integer id, FieldSetting)` - æ›´æ–°æ¬„ä½è¨­å®š
- âœ… `deleteFieldSetting(Integer id)` - è»Ÿåˆªé™¤æ¬„ä½è¨­å®š

**DailyRecordService**ï¼ˆæ ¸å¿ƒï¼šEAV æ¨¡å¼è½‰æ›ï¼‰
- âœ… `getAllRecordsByUserId(Long userId)` - ç²å–ä½¿ç”¨è€…æ‰€æœ‰è¨˜éŒ„
  - EAV æŸ¥è©¢ â†’ æ‰å¹³åŒ– DTO è½‰æ›
- âœ… `getRecordByDate(Long userId, LocalDate date)` - æ ¹æ“šæ—¥æœŸç²å–è¨˜éŒ„
  - EAV æŸ¥è©¢ â†’ æ‰å¹³åŒ– DTO è½‰æ›
- âœ… `saveRecord(Long userId, RecordRequestDTO)` - ä¿å­˜è¨˜éŒ„ï¼ˆå‰µå»ºæˆ–æ›´æ–°ï¼‰
  - æ‰å¹³åŒ– DTO â†’ EAV æ ¼å¼è½‰æ›
  - è‡ªå‹•è™•ç†å‰µå»ºå’Œæ›´æ–°
- âœ… `deleteRecord(Long userId, LocalDate date)` - åˆªé™¤è¨˜éŒ„

**ReportService**
- âœ… `getTrendData(Long userId, String fieldName, LocalDate startDate, LocalDate endDate)` - ç²å–è¶¨å‹¢æ•¸æ“š
- âœ… `getTrendDataWithNulls(...)` - ç²å–è¶¨å‹¢æ•¸æ“šï¼ˆåŒ…å«ç©ºå€¼ï¼‰

**JwtTokenUtil**
- âœ… `generateAccessToken(Long userId, String email, String role)` - ç”Ÿæˆ Access Token
- âœ… `validateToken(String token)` - é©—è­‰ Token
- âœ… `getUserIdFromToken(String token)` - å¾ Token æå–ä½¿ç”¨è€… ID
- âœ… `getAccessTokenExpiration()` - ç²å– Access Token éæœŸæ™‚é–“

**æ¸¬è©¦çµæœï¼š** æ‰€æœ‰ Service æ¸¬è©¦é€šéï¼ˆä½¿ç”¨ Mockitoï¼‰

### 3. Web å±¤ï¼ˆapp-webï¼‰

#### Controller é¡åˆ¥

**AuthController** (`/api/auth`)
- âœ… `POST /api/auth/login` - ä½¿ç”¨è€…ç™»å…¥
- âœ… `POST /api/auth/refresh` - åˆ·æ–° Access Token
- âœ… `POST /api/auth/logout` - ä½¿ç”¨è€…ç™»å‡º

**FieldSettingController** (`/api`)
- âœ… `GET /api/settings/fields` - ç²å–æ‰€æœ‰å•Ÿç”¨çš„æ¬„ä½è¨­å®šï¼ˆå…¬é–‹ç«¯é»ï¼‰
- âœ… `GET /api/admin/settings/fields` - ç²å–æ‰€æœ‰æ¬„ä½è¨­å®šï¼ˆéœ€ Adminï¼‰
- âœ… `GET /api/admin/settings/fields/{id}` - æ ¹æ“š ID ç²å–æ¬„ä½è¨­å®šï¼ˆéœ€ Adminï¼‰
- âœ… `POST /api/admin/settings/fields` - å‰µå»ºæ¬„ä½è¨­å®šï¼ˆéœ€ Adminï¼‰
- âœ… `PUT /api/admin/settings/fields/{id}` - æ›´æ–°æ¬„ä½è¨­å®šï¼ˆéœ€ Adminï¼‰
- âœ… `DELETE /api/admin/settings/fields/{id}` - åˆªé™¤æ¬„ä½è¨­å®šï¼ˆéœ€ Adminï¼‰

**DailyRecordController** (`/api/records`)
- âœ… `GET /api/records` - ç²å–ç•¶å‰ç”¨æˆ¶çš„æ‰€æœ‰è¨˜éŒ„ï¼ˆéœ€èªè­‰ï¼‰
- âœ… `GET /api/records/{date}` - æ ¹æ“šæ—¥æœŸç²å–å–®æ—¥è¨˜éŒ„ï¼ˆéœ€èªè­‰ï¼‰
- âœ… `POST /api/records` - å‰µå»ºæˆ–æ›´æ–°æ¯æ—¥è¨˜éŒ„ï¼ˆéœ€èªè­‰ï¼‰
- âœ… `DELETE /api/records/{date}` - åˆªé™¤æŒ‡å®šæ—¥æœŸçš„è¨˜éŒ„ï¼ˆéœ€èªè­‰ï¼‰

**ReportController** (`/api/reports`)
- âœ… `GET /api/reports/trend` - ç²å–è¶¨å‹¢æ•¸æ“šï¼ˆéœ€èªè­‰ï¼‰
  - åƒæ•¸ï¼š`fieldName`, `startDate`, `endDate`, `includeNulls`ï¼ˆå¯é¸ï¼‰

#### é…ç½®é¡åˆ¥

**SecurityConfig**
- âœ… Spring Security é…ç½®
- âœ… å…¬é–‹ç«¯é»ï¼š`/api/auth/login`, `/api/auth/logout`, `/api/settings/fields`
- âœ… èªè­‰ç«¯é»ï¼šå…¶ä»–æ‰€æœ‰ `/api/**` ç«¯é»
- âœ… è§’è‰²æ¬Šé™æ§åˆ¶ï¼š`/api/admin/**` éœ€ ADMIN è§’è‰²

**PasswordEncoderConfig**
- âœ… å¯†ç¢¼ç·¨ç¢¼å™¨é…ç½®ï¼ˆè§£æ±ºå¾ªç’°ä¾è³´å•é¡Œï¼‰
- âœ… ä½¿ç”¨ BCrypt å¯†ç¢¼ç·¨ç¢¼

**JwtRequestFilter**
- âœ… JWT Token é©—è­‰éæ¿¾å™¨
- âœ… å¾ `Authorization: Bearer <token>` Header æå– Token
- âœ… é©—è­‰ Token ä¸¦è¨­ç½® Spring Security Authentication

**SecurityUtil**
- âœ… å¾ HttpServletRequest æå–ç•¶å‰ä½¿ç”¨è€… ID
- âœ… å¾ SecurityContext ç²å–èªè­‰è³‡è¨Š

**æ¸¬è©¦çµæœï¼š** 31 å€‹ Controller æ¸¬è©¦å…¨éƒ¨é€šéï¼ˆä½¿ç”¨ `@SpringBootTest` + `@AutoConfigureMockMvc`ï¼‰

---

## ğŸ“¡ API æ–‡æª”

### èªè­‰ç«¯é»

#### POST /api/auth/login
**æè¿°ï¼š** ä½¿ç”¨è€…ç™»å…¥

**è«‹æ±‚é«”ï¼š**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**éŸ¿æ‡‰ï¼š**
- **200 OK**
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "tokenType": "Bearer",
  "expiresIn": 900000
}
```
- **401 Unauthorized** - èªè­‰å¤±æ•—

**èªªæ˜ï¼š**
- Refresh Token æœƒè‡ªå‹•è¨­ç½®åˆ° HTTP-only Cookieï¼ˆ`refresh_token`ï¼‰
- Cookie æœ‰æ•ˆæœŸï¼š7 å¤©

---

#### POST /api/auth/refresh
**æè¿°ï¼š** åˆ·æ–° Access Token

**è«‹æ±‚ï¼š** ç„¡éœ€è«‹æ±‚é«”ï¼ŒRefresh Token å¾ Cookie è‡ªå‹•è®€å–

**éŸ¿æ‡‰ï¼š**
- **200 OK**
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "tokenType": "Bearer",
  "expiresIn": 900000
}
```
- **401 Unauthorized** - Refresh Token ç„¡æ•ˆæˆ–éæœŸ

**èªªæ˜ï¼š**
- æœƒè‡ªå‹•æ›´æ–° Refresh Token Cookie

---

#### POST /api/auth/logout
**æè¿°ï¼š** ä½¿ç”¨è€…ç™»å‡º

**è«‹æ±‚ï¼š** ç„¡éœ€è«‹æ±‚é«”ï¼ŒRefresh Token å¾ Cookie è‡ªå‹•è®€å–

**éŸ¿æ‡‰ï¼š**
- **200 OK** - ç™»å‡ºæˆåŠŸ

**èªªæ˜ï¼š**
- æ¸…é™¤ Refresh Token Cookie
- å¾ Redis åˆªé™¤ Refresh Token

---

### æ¬„ä½è¨­å®šç«¯é»

#### GET /api/settings/fields
**æè¿°ï¼š** ç²å–æ‰€æœ‰å•Ÿç”¨çš„æ¬„ä½è¨­å®šï¼ˆå…¬é–‹ç«¯é»ï¼‰

**éŸ¿æ‡‰ï¼š**
- **200 OK**
```json
[
  {
    "settingId": 1,
    "fieldName": "é«”é‡",
    "dataType": "NUMBER",
    "unit": "kg",
    "isRequired": true,
    "options": null,
    "isActive": true
  }
]
```

---

#### GET /api/admin/settings/fields
**æè¿°ï¼š** ç²å–æ‰€æœ‰æ¬„ä½è¨­å®šï¼ˆåŒ…å«æœªå•Ÿç”¨çš„ï¼Œéœ€ Admin æ¬Šé™ï¼‰

**èªè­‰ï¼š** éœ€èªè­‰ + ADMIN è§’è‰²

**éŸ¿æ‡‰ï¼š** åŒä¸Šï¼Œä½†åŒ…å«æ‰€æœ‰æ¬„ä½ï¼ˆåŒ…å« `isActive: false`ï¼‰

---

#### POST /api/admin/settings/fields
**æè¿°ï¼š** å‰µå»ºæ¬„ä½è¨­å®šï¼ˆéœ€ Admin æ¬Šé™ï¼‰

**èªè­‰ï¼š** éœ€èªè­‰ + ADMIN è§’è‰²

**è«‹æ±‚é«”ï¼š**
```json
{
  "fieldName": "é«”é‡",
  "dataType": "NUMBER",
  "unit": "kg",
  "isRequired": true,
  "options": null,
  "isActive": true
}
```

**éŸ¿æ‡‰ï¼š**
- **201 Created** - å‰µå»ºæˆåŠŸï¼Œè¿”å›å‰µå»ºçš„æ¬„ä½è¨­å®š
- **400 Bad Request** - è«‹æ±‚æ•¸æ“šç„¡æ•ˆ

---

#### PUT /api/admin/settings/fields/{id}
**æè¿°ï¼š** æ›´æ–°æ¬„ä½è¨­å®šï¼ˆéœ€ Admin æ¬Šé™ï¼‰

**èªè­‰ï¼š** éœ€èªè­‰ + ADMIN è§’è‰²

**è«‹æ±‚é«”ï¼š** åŒä¸Š

**éŸ¿æ‡‰ï¼š**
- **200 OK** - æ›´æ–°æˆåŠŸ
- **400 Bad Request** - è«‹æ±‚æ•¸æ“šç„¡æ•ˆ
- **404 Not Found** - æ¬„ä½è¨­å®šä¸å­˜åœ¨

---

#### DELETE /api/admin/settings/fields/{id}
**æè¿°ï¼š** åˆªé™¤æ¬„ä½è¨­å®šï¼ˆè»Ÿåˆªé™¤ï¼Œéœ€ Admin æ¬Šé™ï¼‰

**èªè­‰ï¼š** éœ€èªè­‰ + ADMIN è§’è‰²

**éŸ¿æ‡‰ï¼š**
- **204 No Content** - åˆªé™¤æˆåŠŸ
- **404 Not Found** - æ¬„ä½è¨­å®šä¸å­˜åœ¨

---

### è¨˜éŒ„ç®¡ç†ç«¯é»

#### GET /api/records
**æè¿°ï¼š** ç²å–ç•¶å‰ç”¨æˆ¶çš„æ‰€æœ‰è¨˜éŒ„

**èªè­‰ï¼š** éœ€èªè­‰

**éŸ¿æ‡‰ï¼š**
- **200 OK**
```json
[
  {
    "recordId": 1,
    "recordDate": "2024-12-27",
    "createdAt": "2024-12-27T10:00:00+08:00",
    "fieldValues": {
      "é«”é‡": "70.5",
      "è¡€å£“": "120/80"
    }
  }
]
```
- **401 Unauthorized** - æœªèªè­‰

---

#### GET /api/records/{date}
**æè¿°ï¼š** æ ¹æ“šæ—¥æœŸç²å–å–®æ—¥è¨˜éŒ„

**èªè­‰ï¼š** éœ€èªè­‰

**è·¯å¾‘åƒæ•¸ï¼š**
- `date` - æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰

**éŸ¿æ‡‰ï¼š**
- **200 OK** - è¿”å›è¨˜éŒ„è©³æƒ…ï¼ˆæ ¼å¼åŒä¸Šï¼‰
- **404 Not Found** - è©²æ—¥æœŸæ²’æœ‰è¨˜éŒ„
- **401 Unauthorized** - æœªèªè­‰

---

#### POST /api/records
**æè¿°ï¼š** å‰µå»ºæˆ–æ›´æ–°æ¯æ—¥è¨˜éŒ„

**èªè­‰ï¼š** éœ€èªè­‰

**è«‹æ±‚é«”ï¼š**
```json
{
  "recordDate": "2024-12-27",
  "fieldValues": {
    "é«”é‡": "70.5",
    "è¡€å£“": "120/80",
    "å‚™è¨»": "ä»Šå¤©æ„Ÿè¦ºè‰¯å¥½"
  }
}
```

**éŸ¿æ‡‰ï¼š**
- **200 OK** - ä¿å­˜æˆåŠŸï¼Œè¿”å›è¨˜éŒ„è©³æƒ…
- **400 Bad Request** - è«‹æ±‚æ•¸æ“šç„¡æ•ˆ
- **401 Unauthorized** - æœªèªè­‰

**èªªæ˜ï¼š**
- å¦‚æœè©²æ—¥æœŸçš„è¨˜éŒ„å·²å­˜åœ¨ï¼Œå‰‡æ›´æ–°ï¼›å¦å‰‡å‰µå»ºæ–°è¨˜éŒ„
- å¾Œç«¯æœƒè‡ªå‹•å°‡æ‰å¹³åŒ– JSON è½‰æ›ç‚º EAV æ ¼å¼å­˜å„²

---

#### DELETE /api/records/{date}
**æè¿°ï¼š** åˆªé™¤æŒ‡å®šæ—¥æœŸçš„è¨˜éŒ„

**èªè­‰ï¼š** éœ€èªè­‰

**è·¯å¾‘åƒæ•¸ï¼š**
- `date` - æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰

**éŸ¿æ‡‰ï¼š**
- **204 No Content** - åˆªé™¤æˆåŠŸ
- **404 Not Found** - è¨˜éŒ„ä¸å­˜åœ¨
- **401 Unauthorized** - æœªèªè­‰

---

### å ±è¡¨ç«¯é»

#### GET /api/reports/trend
**æè¿°ï¼š** ç²å–è¶¨å‹¢æ•¸æ“š

**èªè­‰ï¼š** éœ€èªè­‰

**æŸ¥è©¢åƒæ•¸ï¼š**
- `fieldName` (å¿…å¡«) - æ¬„ä½åç¨±
- `startDate` (å¿…å¡«) - é–‹å§‹æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
- `endDate` (å¿…å¡«) - çµæŸæ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
- `includeNulls` (å¯é¸) - æ˜¯å¦åŒ…å«ç©ºå€¼ï¼ˆé è¨­ï¼šfalseï¼‰

**éŸ¿æ‡‰ï¼š**
- **200 OK**
```json
[
  {
    "date": "2024-12-27",
    "value": "70.5"
  },
  {
    "date": "2024-12-28",
    "value": "71.0"
  }
]
```
- **400 Bad Request** - è«‹æ±‚åƒæ•¸ç„¡æ•ˆ
- **401 Unauthorized** - æœªèªè­‰

---

## ğŸ”’ å®‰å…¨æ©Ÿåˆ¶

### JWT Token æ©Ÿåˆ¶

#### Access Token
- **å­˜å„²ä½ç½®ï¼š** å‰ç«¯ Pinia Store
- **æœ‰æ•ˆæœŸï¼š** 15 åˆ†é˜ï¼ˆ900,000 æ¯«ç§’ï¼‰
- **ä½¿ç”¨æ–¹å¼ï¼š** æ¯æ¬¡ API è«‹æ±‚æ™‚æ·»åŠ åˆ° `Authorization: Bearer <token>` Header
- **å…§å®¹ï¼š** userId, email, role

#### Refresh Token
- **å­˜å„²ä½ç½®ï¼š** HTTP-only Cookieï¼ˆåç¨±ï¼š`refresh_token`ï¼‰
- **æœ‰æ•ˆæœŸï¼š** 7 å¤©ï¼ˆ604,800,000 æ¯«ç§’ï¼‰
- **ä½¿ç”¨æ–¹å¼ï¼š** è‡ªå‹•å¾ Cookie è®€å–ï¼ˆå‰ç«¯ç„¡éœ€æ‰‹å‹•è™•ç†ï¼‰
- **å­˜å„²ï¼š** Redisï¼ˆKey: `refresh_token:{tokenId}`, Value: `userId`ï¼‰

#### Token åˆ·æ–°æµç¨‹
1. API è«‹æ±‚è¿”å› 401ï¼ˆAccess Token éæœŸï¼‰
2. å‰ç«¯ Response æ””æˆªå™¨æ•ç² 401
3. è‡ªå‹•èª¿ç”¨ `/api/auth/refresh`ï¼ˆCookie è‡ªå‹•æ”œå¸¶ Refresh Tokenï¼‰
4. å¾Œç«¯é©—è­‰ Refresh Token ä¸¦ç”Ÿæˆæ–°çš„ Access Token å’Œ Refresh Token
5. å‰ç«¯æ›´æ–° Access Token ä¸¦é‡è©¦åŸæœ¬å¤±æ•—çš„è«‹æ±‚

### Spring Security é…ç½®

#### å…¬é–‹ç«¯é»
- `/api/auth/login` - ç™»å…¥
- `/api/auth/logout` - ç™»å‡º
- `/api/settings/fields` - ç²å–å•Ÿç”¨çš„æ¬„ä½è¨­å®š

#### èªè­‰ç«¯é»
- å…¶ä»–æ‰€æœ‰ `/api/**` ç«¯é»éƒ½éœ€è¦èªè­‰
- ä½¿ç”¨ JWT Access Token é©—è­‰

#### è§’è‰²æ¬Šé™
- `/api/admin/**` - éœ€è¦ ADMIN è§’è‰²
- å…¶ä»–ç«¯é» - éœ€è¦ USER æˆ– ADMIN è§’è‰²

---

## ğŸ§ª æ¸¬è©¦çµæœ

### æ¸¬è©¦çµ±è¨ˆ
- **ç¸½æ¸¬è©¦æ•¸ï¼š** 31 å€‹
- **é€šéæ•¸ï¼š** 31 å€‹
- **å¤±æ•—æ•¸ï¼š** 0 å€‹
- **éŒ¯èª¤æ•¸ï¼š** 0 å€‹
- **é€šéç‡ï¼š** 100%

### æ¸¬è©¦åˆ†é¡

#### Repository æ¸¬è©¦ï¼ˆ5 å€‹ï¼‰
- âœ… `UserRepositoryTest`
- âœ… `RoleRepositoryTest`
- âœ… `FieldSettingRepositoryTest`
- âœ… `DailyRecordRepositoryTest`
- âœ… `RecordDataRepositoryTest`

**æ¸¬è©¦ç’°å¢ƒï¼š** `@DataJpaTest` + H2 å…§å­˜è³‡æ–™åº«

#### Service æ¸¬è©¦ï¼ˆ4 å€‹ï¼‰
- âœ… `RefreshTokenServiceTest`
- âœ… `FieldSettingServiceTest`
- âœ… `DailyRecordServiceTest`
- âœ… `ReportServiceTest`

**æ¸¬è©¦ç’°å¢ƒï¼š** Mockito

#### Controller æ¸¬è©¦ï¼ˆ4 å€‹ï¼‰
- âœ… `AuthControllerTest`
- âœ… `FieldSettingControllerTest`
- âœ… `DailyRecordControllerTest`
- âœ… `ReportControllerTest`

**æ¸¬è©¦ç’°å¢ƒï¼š** `@SpringBootTest` + `@AutoConfigureMockMvc`

---

## âš™ï¸ é…ç½®èªªæ˜

### application.properties

#### è³‡æ–™åº«é…ç½®ï¼ˆPostgreSQLï¼‰
```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/postgres
spring.datasource.username=postgres
spring.datasource.password=postgres
spring.datasource.driver-class-name=org.postgresql.Driver

spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.time_zone=Asia/Taipei
```

#### Redis é…ç½®
```properties
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0
```

#### JWT é…ç½®
```properties
jwt.secret=your-secret-key-change-this-in-production-minimum-256-bits
jwt.access-token.expiration=900000        # 15 åˆ†é˜
jwt.refresh-token.expiration=604800000    # 7 å¤©
```

#### æ‡‰ç”¨ç¨‹å¼é…ç½®
```properties
server.port=8080
spring.jackson.time-zone=Asia/Taipei
spring.jackson.serialization.write-dates-as-timestamps=false
```

### application-test.properties

æ¸¬è©¦ç’°å¢ƒä½¿ç”¨ H2 å…§å­˜è³‡æ–™åº«ï¼š
```properties
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driver-class-name=org.h2.Driver
spring.jpa.hibernate.ddl-auto=create-drop
```

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å‰ç½®éœ€æ±‚
- Java 21 æˆ–æ›´é«˜ç‰ˆæœ¬
- PostgreSQL 12 æˆ–æ›´é«˜ç‰ˆæœ¬
- Redis 6 æˆ–æ›´é«˜ç‰ˆæœ¬
- Maven 3.6 æˆ–æ›´é«˜ç‰ˆæœ¬

### éƒ¨ç½²æ­¥é©Ÿ

1. **é…ç½®è³‡æ–™åº«**
   ```sql
   CREATE DATABASE health_log;
   ```

2. **é…ç½® Redis**
   - ç¢ºä¿ Redis æœå‹™é‹è¡Œåœ¨ `localhost:6379`

3. **æ›´æ–°é…ç½®æª”æ¡ˆ**
   - ä¿®æ”¹ `application.properties` ä¸­çš„è³‡æ–™åº«é€£æ¥è³‡è¨Š
   - ä¿®æ”¹ JWT Secretï¼ˆç”Ÿç”¢ç’°å¢ƒå¿…é ˆæ›´æ”¹ï¼‰
   - è¨­ç½® `spring.jpa.hibernate.ddl-auto=update` æˆ–ä½¿ç”¨ Flyway/Liquibase

4. **æ§‹å»ºå°ˆæ¡ˆ**
   ```bash
   cd health-log-java
   mvn clean package
   ```

5. **é‹è¡Œæ‡‰ç”¨ç¨‹å¼**
   ```bash
   java -jar app-web/target/app-web-0.0.1-SNAPSHOT.jar
   ```

6. **é©—è­‰éƒ¨ç½²**
   - è¨ªå• `http://localhost:8080/api/settings/fields` æ‡‰è©²è¿”å›æ¬„ä½è¨­å®šåˆ—è¡¨

### Docker éƒ¨ç½²ï¼ˆå¯é¸ï¼‰

å¯ä»¥ä½¿ç”¨å°ˆæ¡ˆæ ¹ç›®éŒ„çš„ `compose.yml` é€²è¡Œ Docker éƒ¨ç½²ã€‚

---

## ğŸ’¡ æŠ€è¡“äº®é»

### 1. EAV æ¨¡å¼è½‰æ›

**å•é¡Œï¼š** éœ€è¦æ”¯æ´å‹•æ…‹æ¬„ä½ï¼Œä½†å‚³çµ±é—œè¯å¼è³‡æ–™åº«çµæ§‹å›ºå®š

**è§£æ±ºæ–¹æ¡ˆï¼š** ä½¿ç”¨ EAVï¼ˆEntity-Attribute-Valueï¼‰æ¨¡å¼
- **å­˜å„²ï¼š** ä½¿ç”¨ `FieldSetting`ï¼ˆAttributeï¼‰å’Œ `RecordData`ï¼ˆValueï¼‰è¡¨
- **è½‰æ›ï¼š** Service å±¤è‡ªå‹•è™•ç† EAV â†” æ‰å¹³åŒ– JSON è½‰æ›
- **å„ªå‹¢ï¼š** éˆæ´»æ”¯æ´å‹•æ…‹æ¬„ä½ï¼Œç„¡éœ€ä¿®æ”¹è³‡æ–™åº«çµæ§‹

**å¯¦ç¾ï¼š**
- å‰µå»ºè¨˜éŒ„ï¼šæ‰å¹³åŒ– JSON â†’ EAV æ ¼å¼
- æŸ¥è©¢è¨˜éŒ„ï¼šEAV æ ¼å¼ â†’ æ‰å¹³åŒ– JSON

### 2. JWT Token é›™ Token æ©Ÿåˆ¶

**Access Tokenï¼š** çŸ­æš«éæœŸï¼ˆ15 åˆ†é˜ï¼‰ï¼Œå­˜æ–¼å‰ç«¯
**Refresh Tokenï¼š** é•·æœŸéæœŸï¼ˆ7 å¤©ï¼‰ï¼Œå­˜æ–¼ HTTP-only Cookie + Redis

**å„ªå‹¢ï¼š**
- å®‰å…¨æ€§ï¼šRefresh Token å­˜æ–¼ HTTP-only Cookieï¼Œé˜²æ­¢ XSS æ”»æ“Š
- æ€§èƒ½ï¼šAccess Token çŸ­æš«éæœŸï¼Œæ¸›å°‘å®‰å…¨é¢¨éšª
- ç”¨æˆ¶é«”é©—ï¼šè‡ªå‹•åˆ·æ–° Tokenï¼Œç„¡éœ€é‡æ–°ç™»å…¥

### 3. Maven å¤šæ¨¡çµ„æ¶æ§‹

**å„ªå‹¢ï¼š**
- è·è²¬åˆ†é›¢ï¼šæ¯å€‹æ¨¡çµ„è·è²¬æ˜ç¢º
- ä¾è³´ç®¡ç†ï¼šæ¸…æ™°çš„æ¨¡çµ„ä¾è³´é—œä¿‚
- å¯ç¶­è­·æ€§ï¼šæ˜“æ–¼æ“´å±•å’Œç¶­è­·
- æ¸¬è©¦ï¼šå¯ä»¥ç¨ç«‹æ¸¬è©¦æ¯å€‹æ¨¡çµ„

### 4. å®Œæ•´çš„æ¸¬è©¦è¦†è“‹

- **Repository æ¸¬è©¦ï¼š** ä½¿ç”¨ H2 å…§å­˜è³‡æ–™åº«
- **Service æ¸¬è©¦ï¼š** ä½¿ç”¨ Mockito æ¨¡æ“¬ä¾è³´
- **Controller æ¸¬è©¦ï¼š** ä½¿ç”¨ `@SpringBootTest` é€²è¡Œæ•´åˆæ¸¬è©¦
- **æ¸¬è©¦çµæœï¼š** 31 å€‹æ¸¬è©¦å…¨éƒ¨é€šé

### 5. Spring Security æ•´åˆ

- JWT é©—è­‰éæ¿¾å™¨
- è§’è‰²æ¬Šé™æ§åˆ¶
- å…¬é–‹ç«¯é»é…ç½®
- å®‰å…¨å·¥å…·é¡å°è£

---

## ğŸ› å·²è§£æ±ºçš„å•é¡Œ

1. âœ… **Maven å¤šæ¨¡çµ„ä¾è³´å•é¡Œ** - æ­£ç¢ºé…ç½®æ¨¡çµ„ä¾è³´
2. âœ… **`@DataJpaTest` æ‰¾ä¸åˆ° `@SpringBootConfiguration`** - å‰µå»º `TestApplication.java`
3. âœ… **Mockito åœ¨ Java 21 çš„å…¼å®¹æ€§å•é¡Œ** - ä½¿ç”¨ `mockito-subclass`
4. âœ… **å¾ªç’°ä¾è³´å•é¡Œ** - `PasswordEncoder` åˆ†é›¢åˆ°ç¨ç«‹é…ç½®é¡
5. âœ… **Controller æ¸¬è©¦å•é¡Œ** - å¾ `@WebMvcTest` åˆ‡æ›åˆ° `@SpringBootTest`
6. âœ… **Security é…ç½®å•é¡Œ** - `/api/auth/logout` å’Œ `/api/settings/fields` è¨­ç‚ºå…¬é–‹ç«¯é»

---

## ğŸ“Š é–‹ç™¼çµ±è¨ˆ

- **ç¸½é¡åˆ¥æ•¸ï¼š** ç´„ 30+ å€‹
- **ç¸½æ¸¬è©¦æ•¸ï¼š** 31 å€‹
- **API ç«¯é»æ•¸ï¼š** 13 å€‹
- **Maven æ¨¡çµ„æ•¸ï¼š** 4 å€‹
- **è³‡æ–™åº«è¡¨æ•¸ï¼š** 5 å€‹
- **ç¨‹å¼ç¢¼è¡Œæ•¸ï¼š** ç´„ 3,000+ è¡Œ

---

## ğŸ¯ ç¸½çµ

å¾Œç«¯é–‹ç™¼å·²å…¨éƒ¨å®Œæˆï¼Œå¯¦ç¾äº†ï¼š

âœ… **å®Œæ•´çš„ RESTful API** - 13 å€‹ç«¯é»ï¼Œæ¶µè“‹èªè­‰ã€è¨˜éŒ„ç®¡ç†ã€å ±è¡¨ã€è¨­å®šç®¡ç†  
âœ… **å®‰å…¨èªè­‰æ©Ÿåˆ¶** - JWT é›™ Token æ©Ÿåˆ¶ï¼ŒSpring Security æ•´åˆ  
âœ… **EAV æ¨¡å¼å¯¦ç¾** - éˆæ´»çš„å‹•æ…‹æ¬„ä½ç³»çµ±  
âœ… **å®Œæ•´çš„æ¸¬è©¦è¦†è“‹** - 31 å€‹æ¸¬è©¦å…¨éƒ¨é€šé  
âœ… **æ¸…æ™°çš„æ¶æ§‹è¨­è¨ˆ** - Maven å¤šæ¨¡çµ„ï¼Œè·è²¬åˆ†é›¢  

**ä¸‹ä¸€æ­¥ï¼š** èˆ‡å‰ç«¯æ•´åˆæ¸¬è©¦ï¼Œç¢ºä¿å‰å¾Œç«¯æ­£å¸¸é‹ä½œã€‚

---

**æç¤ºï¼š** è©³ç´°çš„æ¶æ§‹è¨­è¨ˆè«‹åƒè€ƒ `å¾Œç«¯æ¨¡çµ„åŠé¡åˆ¥æ¶æ§‹è¨­è¨ˆ.md`ï¼Œæ•´é«”å°ˆæ¡ˆç‹€æ…‹è«‹åƒè€ƒ `å°ˆæ¡ˆç‹€æ…‹ç¸½çµ.md`ã€‚

